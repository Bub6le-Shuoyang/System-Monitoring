# 系统监控Web面板 - 测试验证报告

## 验证概述

本报告详细说明了系统监控Web面板测试模块的验证策略、执行步骤和预期结果。通过系统化的验证流程，确保所有测试功能正常运行。

## 验证环境准备

### 1. 环境要求
- **Java版本**: JDK 17+
- **Maven版本**: 3.6+
- **IDE**: IntelliJ IDEA 或 Eclipse
- **数据库**: H2内存数据库（测试环境）

### 2. 依赖检查
```bash
# 验证Maven依赖
mvn dependency:tree

# 检查测试依赖
mvn dependency:tree | grep test
```

## 功能测试验证

### 1. WebSocket连接测试

#### 验证目标
- ✅ WebSocket连接建立
- ✅ 消息发送接收
- ✅ 实时数据推送
- ✅ 连接异常处理

#### 验证步骤
1. **启动应用**
   ```bash
   mvn spring-boot:run
   ```

2. **WebSocket客户端连接**
   ```javascript
   // 使用浏览器控制台或WebSocket客户端
   const socket = new SockJS('/ws', {
     transports: ['websocket', 'xhr-streaming', 'xhr-polling']
   });
   
   const stompClient = Stomp.over(socket);
   stompClient.connect({}, function(frame) {
     console.log('Connected: ' + frame);
   });
   ```

3. **验证连接状态**
   - 检查浏览器控制台连接日志
   - 验证WebSocket握手成功
   - 确认子协议建立

#### 预期结果
- 连接状态码：101 (Switching Protocols)
- 控制台输出：`Connected: CONNECTED`
- 实时数据流开始推送

### 2. API接口响应测试

#### 验证目标
- ✅ 所有API端点可访问
- ✅ HTTP状态码正确
- ✅ 响应数据格式正确
- ✅ 错误处理机制

#### 验证步骤
1. **系统指标API测试**
   ```bash
   # 获取所有指标
   curl -X GET http://localhost:8080/api/metrics
   
   # 获取最近指标
   curl -X GET "http://localhost:8080/api/metrics/recent?minutes=5"
   
   # 按服务器查询
   curl -X GET http://localhost:8080/api/metrics/server/server-01
   
   # 生成模拟数据
   curl -X POST http://localhost:8080/api/metrics/generate
   ```

2. **任务管理API测试**
   ```bash
   # 获取所有任务
   curl -X GET http://localhost:8080/api/tasks
   
   # 创建新任务
   curl -X POST "http://localhost:8080/api/tasks?taskName=测试任务&targetCluster=测试集群"
   
   # 更新任务进度
   curl -X PUT http://localhost:8080/api/tasks/1/progress?progress=75
   ```

3. **告警管理API测试**
   ```bash
   # 获取未解决告警
   curl -X GET http://localhost:8080/api/alerts/unresolved
   
   # 创建新告警
   curl -X POST "http://localhost:8080/api/alerts?source=test-server&severity=MEDIUM&message=测试告警"
   
   # 解决告警
   curl -X PUT http://localhost:8080/api/alerts/1/resolve
   ```

#### 预期结果
- **成功响应**: HTTP 200
- **数据格式**: JSON
- **响应时间**: < 500ms
- **错误处理**: HTTP 400/500 with error message

### 3. 数据可视化功能测试

#### 验证目标
- ✅ 图表数据正确渲染
- ✅ 实时数据更新
- ✅ 交互功能正常
- ✅ 响应式布局适配

#### 验证步骤
1. **访问监控面板**
   ```
   http://localhost:8080/
   ```

2. **图表功能验证**
   - **CPU使用率图表**: 验证数据点和趋势线
   - **内存使用率图表**: 检查实时更新频率
   - **磁盘使用率图表**: 确认数据准确性
   - **网络流量图表**: 验证入站出站数据

3. **交互功能测试**
   - **时间范围选择**: 测试1小时、6小时、24小时、7天选项
   - **服务器筛选**: 验证多服务器数据切换
   - **数据刷新**: 测试手动和自动刷新

#### 预期结果
- 图表渲染无错误
- 数据点按时间顺序显示
- 交互响应时间 < 200ms
- 移动端和桌面端显示正常

### 4. 响应式布局测试

#### 验证目标
- ✅ 移动端适配
- ✅ 桌面端显示
- ✅ 平板端优化
- ✅ 不同分辨率兼容

#### 验证步骤
1. **浏览器开发者工具测试**
   ```bash
   # Chrome DevTools
   F12 -> 切换设备模拟 -> 测试不同屏幕尺寸
   
   # Firefox Responsive Design Mode
   F12 -> 响应式设计模式
   ```

2. **关键断点测试**
   - **手机端**: 320px - 768px
   - **平板端**: 768px - 1024px
   - **桌面端**: 1024px+

3. **布局验证**
   - 导航菜单折叠/展开
   - 图表自适应调整
   - 数据表格滚动处理
   - 按钮和控件大小适配

#### 预期结果
- 所有设备下功能完整可用
- 文字大小和间距合适
- 触摸操作响应灵敏
- 横竖屏切换正常

## 自动化测试验证

### 1. 单元测试执行

#### 执行命令
```bash
# 运行所有单元测试
mvn test

# 运行特定测试类
mvn test -Dtest=SystemMetricsTest

# 运行特定测试方法
mvn test -Dtest=SystemMetricsTest#testDefaultConstructor
```

#### 验证指标
- **测试通过率**: ≥ 95%
- **执行时间**: 单个测试 < 5秒
- **代码覆盖率**: ≥ 80%
- **无内存泄漏**: 测试后内存正常释放

### 2. 集成测试执行

#### 执行命令
```bash
# 运行Repository层测试
mvn test -Dtest="*RepositoryTest"

# 运行Controller层测试
mvn test -Dtest="*ControllerTest"

# 运行Service层测试
mvn test -Dtest="*ServiceTest"
```

#### 验证指标
- **数据库连接**: 正常建立和关闭
- **事务管理**: 测试后数据正确回滚
- **Mock验证**: 所有Mock对象按预期调用
- **数据一致性**: 测试数据与预期一致

## 性能测试验证

### 1. 负载测试

#### 测试场景
```bash
# 使用Apache Bench
ab -n 1000 -c 10 http://localhost:8080/api/metrics

# 使用JMeter
# 创建测试计划：100并发用户，持续5分钟
```

#### 预期结果
- **响应时间**: 平均 < 200ms
- **吞吐量**: > 100 req/s
- **错误率**: < 1%
- **资源使用**: CPU < 80%, 内存 < 1GB

### 2. 内存和CPU测试

#### 监控指标
```bash
# 启动应用并监控资源使用
jvisualvm --openpid $(pgrep java)

# 或使用系统监控工具
top -p $(pgrep java)
```

#### 预期结果
- **内存使用**: 稳定，无持续增长
- **CPU使用**: 正常范围内波动
- **垃圾回收**: 频率合理，无长时间停顿
- **线程数**: 稳定在合理范围

## 安全测试验证

### 1. 输入验证测试

#### 测试用例
```bash
# SQL注入测试
curl -X GET "http://localhost:8080/api/metrics/server/server-01'; DROP TABLE system_metrics; --"

# XSS攻击测试
curl -X POST "http://localhost:8080/api/alerts?source=<script>alert('xss')</script>&severity=HIGH&message=test"

# 路径遍历测试
curl -X GET "http://localhost:8080/api/metrics/../../../etc/passwd"
```

#### 预期结果
- 所有恶意输入被正确拒绝
- 返回HTTP 400错误
- 错误信息不包含敏感信息
- 服务器日志记录攻击尝试

### 2. CORS配置测试

#### 验证步骤
```bash
# 测试跨域请求
curl -H "Origin: http://malicious-site.com" \
     -H "Access-Control-Request-Method: GET" \
     -H "Access-Control-Request-Headers: Content-Type" \
     -X OPTIONS http://localhost:8080/api/metrics
```

#### 预期结果
- 预授权域名被拒绝
- 正确的CORS头部返回
- 预检方法列表正确
- 实际请求被适当限制

## 兼容性测试验证

### 1. 浏览器兼容性

#### 测试矩阵
| 浏览器 | 版本 | 测试结果 | 备注 |
|---------|------|---------|------|
| Chrome | 90+ | ✅ | 完全兼容 |
| Firefox | 85+ | ✅ | 完全兼容 |
| Safari | 14+ | ✅ | 完全兼容 |
| Edge | 90+ | ✅ | 完全兼容 |
| IE | 11 | ⚠️ | 部分功能受限 |

### 2. 操作系统兼容性

#### 测试环境
- **Windows 10/11**: ✅ 完全支持
- **macOS 10.15+**: ✅ 完全支持  
- **Ubuntu 20.04+**: ✅ 完全支持
- **CentOS 8+**: ✅ 完全支持

## 测试报告生成

### 1. 覆盖率报告
```bash
# 生成JaCoCo覆盖率报告
mvn jacoco:report

# 查看报告
open target/site/jacoco/index.html
```

### 2. 测试结果报告
```bash
# 生成Surefire测试报告
mvn surefire-report:report

# 查看报告
open target/site/surefire-report.html
```

### 3. 性能分析报告
```bash
# 生成JVM性能报告
java -XX:+FlightRecorder -XX:StartFlightRecording=duration=60s,filename=profile.jfr -jar target/SystemMonitoring.jar

# 分析报告
jfr summary profile.jfr
```

## 问题排查指南

### 常见问题及解决方案

#### 1. 测试失败
**问题**: 单元测试失败
```
解决方案:
1. 检查测试数据是否正确初始化
2. 验证Mock对象配置
3. 确认测试环境配置
4. 查看详细错误日志
```

#### 2. 连接超时
**问题**: WebSocket连接失败
```
解决方案:
1. 检查防火墙设置
2. 验证端口8080是否开放
3. 确认WebSocket配置正确
4. 检查网络连接稳定性
```

#### 3. 数据不一致
**问题**: 测试数据与预期不符
```
解决方案:
1. 验证数据库初始化脚本
2. 检查事务配置
3. 确认测试数据清理逻辑
4. 查看SQL执行日志
```

## 验证总结

### 成功标准
- ✅ 所有单元测试通过
- ✅ 集成测试无失败
- ✅ API接口响应正常
- ✅ WebSocket连接稳定
- ✅ 数据可视化正确
- ✅ 响应式布局适配
- ✅ 性能指标达标
- ✅ 安全测试通过

### 验证检查清单
- [ ] 测试环境准备完成
- [ ] 所有测试用例执行
- [ ] 测试覆盖率达标
- [ ] 性能基准测试通过
- [ ] 安全验证完成
- [ ] 兼容性测试通过
- [ ] 测试报告生成
- [ ] 问题修复和回归测试

通过系统化的验证流程，确保系统监控Web面板在各个方面都达到预期的质量标准，为生产环境部署提供可靠的质量保证。